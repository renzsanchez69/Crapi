<!DOCTYPE html>
<html>
<head>
	<title>WELCOME</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="js/o-main.js"></script>
	<link rel="stylesheet" type="text/css" href="css/o-main.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="lib/jquery.min.js"></script>
	<script src="lib/bootstrap.min.js"></script>
</head>
<body>

<!-- Top Navigation Menu -->
<div class="topnav" id="myTopnav">
  <a href="o-main.html" class="active">Employee</a>
  <a href="o-menu.html">Food Menu</a>
  <a href="o-sub.html">Subscription</a>
  <a href="o-hist.html">Order History</a>
  <a href="index.html">Logout</a>
  <a href="javascript:void(0);" class="icon" onclick="myFunction()">
	<i class="fa fa-bars"></i>
  </a>
</div>

<div class="main">
	<br>
		<div class="title">
			<h1 id="restoName"></h1>
		</div>
	<br>

  <div class="left">
	<form action="">
		<input class="search" type="text" placeholder="Search.." name="search">
		<button id="btnSearch"><i class="fa fa-search"></i></button>
	</form>
  </div>
  <div class="right">
	<!-- php --><button class="add" id="myAdd" data-toggle="modal" data-target="#ADDemp">ADD EMPLOYEE</button><!-- php -->
  </div>

  <table class="table table-condensed">
	<thead>
	  <tr>
		<th>Name</th>
		<th>Contact No</th>
		<th>Action</th>
	  </tr>
	</thead>
	<tbody id="empListResult"></tbody>

	<!-- data -->
	<tr id="masterEmpRow" class="hidden">
	  <th class="empName">--</th>
	  <th class="empContactNo">--</th>
	  <th>
		<button class="empEditBtn" name="edit_btn" data-toggle="modal" data-target="#EDITemp"><i class="glyphicon glyphicon-edit"></i></button>
		<button class="empDeleteBtn" name="delete_btn" data-toggle="modal" data-target="#DELemp"><i class="glyphicon glyphicon-trash"></i></button>
	  </th>
	</tr>
  </table>
<!--   <div class="t-title">
	<table>
	  <tr>
		<th id="custname">Full name</th>
		<th>contact number</th>
		<th>Action</th>
	  </tr>
	</table>
  </div>
  <div class="t-cust">
	<table class="table">
	  <tr>
		<th id="custname">Junas Bangayan</th>
		<th>09771215342</th>
		<th>
		  <button class="editbut" name="edit_btn" data-toggle="modal" data-target="#EDITemp"><i class="glyphicon glyphicon-edit"></i></button>
		  <button class="deletebut" name="delete_btn" data-toggle="modal" data-target="#DELemp"><i class="glyphicon glyphicon-trash"></i></button>
		</th>
	  </tr>
	</table>
  </div> -->

<!-- Add Modal -->
<div class="modal fade" id="ADDemp" role="dialog" data-backdrop="false">
  <div class="modal-content">
	<div class="modal-header">
	  <span class="close" data-dismiss="modal">&times;</span>
	  <h2>Employee Registration</h2>
	</div>
	<div class="modal-body">
	  <div class="regbox">
		<form class="reg" action="">
		  <input type="text" placeholder="Full name" name="name" required>
		  <input type="text" placeholder="Address" name="address" required>
		  <input type="text" placeholder="Contact number" name="contact" required>
		  <input type="email" placeholder="Email address" name="email" required>
		  <input type="password" placeholder="Password" name="password" required>
		  <button class="submit" name="submit_btn">SUBMIT</button>
		</form>
	  </div>
	</div>
  </div>
</div>

<div class="modal fade" id="EDITemp" role="dialog" data-backdrop="false">
  <div class="modal-dialog modal-lg">
	<div class="modal-content">
	  <div class="modal-header">
		<span class="close" data-dismiss="modal">&times;</span>
		<h2>Edit Employee</h2>
	  </div>
	  <div class="modal-body">
		<div class="regbox">
		  <form class="reg" action="">
		   <input type="text" placeholder="Full name" name="name" value="Junas Bangayan" required>
		   <input type="text" placeholder="Address" name="address" value="Minglanilla, Cebu" required>
		   <input type="text" placeholder="Contact number" name="contact" value="09771215342" required>
		   <input type="email" placeholder="Email address" name="email" value="junasmarcil@gmail.com" required>
		   <input type="password" placeholder="Password" name="password" value="**********" required>
		   <button class="save" name="edit_btn">SAVE</button>
		  </form>
		</div>
	  </div>
	</div>
  </div>
</div>

<div class="modal" id="DELemp" role="dialog" data-backdrop="false">
  <div class="modal-dialog modal-lg">
	<div class="modal-content">
	  <div class="modal-header">
		<span class="close" data-dismiss="modal">&times;</span>
		<h2>Delete Employee</h2>
	  </div>
	  <div class="modal-body">
	  <div class="regbox">
		<p>Are you sure you want to delete this account?</p>
		<button class="delete" name="del_btn">DELETE</button>
		<button data-dismiss="modal">NO</button>
	  </div>
	  </div>
	</div>
  </div>
</div>

</div>

</body>
<script src="common/constants.js"></script>
<script src="common/app.js"></script>
<script>
	$(document).ready(function(){
	
		loadRestaurantInfo();

		loadEmployees();

		$('#btnSearch').click(function(e){
			e.preventDefault();
			loadEmployees();
		});

		$('[name="del_btn"]').click(function(e){
			e.preventDefault();
			deleteEmployee();
		});
	});

  function loadRestaurantInfo(){
	CrapiApp.searchResto({
		owner_id: CrapiApp.config.login_data.user_id
	})
	.then(function(res){
		$('.loader').remove();

		if (res.result === 'OK') {
			if (typeof res.data[0] !== 'undefined') {

				console.warn(res.data[0]);
				var obj = res.data[0];

				$('#restoName').html(obj.resto_name);
			}
		}
	})
	.catch(function(err){
		console.warn(err);
	});
  }

  function loadEmployees(){
  	CrapiApp.showCommonLoader();
	var search = $('[name="search"]').val();
	CrapiApp.searchEmployees({
		name: search, 
		owner_id: CrapiApp.config.login_data.user_id
	})
	.then(function(res){
		$('#empListResult').html('');

		if (res.result === 'OK') {
			for (var key in res.data) {
				// skip loop if the property is from prototype
				if (!res.data.hasOwnProperty(key)) continue;
				var obj = res.data[key];
				var empRow = $('#masterEmpRow').clone();
				empRow.removeClass('hidden');
				empRow.find('.empName').html(obj.fullname);
				empRow.find('.empContactNo').html(obj.contact_number);

				$('#empListResult').append(empRow);
			}
		}
	})
	.always(function(){
		CrapiApp.removeCommonLoader();
	});
  }

  function deleteEmployee(){
  	CrapiApp.showCommonLoader();
	CrapiApp.deleteEmployee({
		id: 1, 
		owner_id: CrapiApp.config.login_data.user_id
	})
	.then(function(res){
		// $('#empListResult').html('');

		// if (res.result === 'OK') {
		// 	for (var key in res.data) {
		// 		// skip loop if the property is from prototype
		// 		if (!res.data.hasOwnProperty(key)) continue;
		// 		var obj = res.data[key];
		// 		var empRow = $('#masterEmpRow').clone();
		// 		empRow.removeClass('hidden');
		// 		empRow.find('.empName').html(obj.fullname);
		// 		empRow.find('.empContactNo').html(obj.contact_number);

		// 		$('#empListResult').append(empRow);
		// 	}
		// }
		console.log(res);
	})
	.always(function(){
		CrapiApp.removeCommonLoader();
	});
  }
</script>
</html>