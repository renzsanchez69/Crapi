<!DOCTYPE html>
<html>
<head>
    <title>CRAPI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,connect-src *">
	<link rel="stylesheet" type="text/css" href="css/login.css">
    <link href="css/jquery.growl.css" rel="stylesheet" type="text/css" />
</head>
<body id="bg-color">
    <div class="title">
        <h1>CraPi</h1>
    </div>

    <div class="container">
        <form class="login" id="login" action="#">
            <input type="email" placeholder="Email address" name="email" required>
            <input type="password" placeholder="Password" name="password" required>
            <button class="submit" name="login_btn" id="log_form">LOGIN</button> 
            <p class="message">Not registered? <a href="c-reg.html"> Sign up</a></p>
            <p class="regis">Owned a restaurant? <a href="o-reg.html"> SUBSCRIBE HERE!</a></p>
        </form>
    </div>
<script src="lib/jquery.min.js"></script>
<script src="js/jquery.growl.js" type="text/javascript"></script>
<script>
    $('#log_form').click(function(e){
        e.preventDefault();
        var mail = $('input[name="email"]').val();
        var pw = $('input[name="password"]').val();
        if (!mail) {
            $.growl.error({ message: "Email address must not be empty!" });
            return false;
        } else {
            if (!validateEmail(mail)) {
                $.growl.error({ message: "Invalid email address!" });
                return false;
            }
        }
        if (!pw) {
            $.growl.error({ message: "Password must not be empty!" });
            return false;
        }
        $.ajax({
            type: "POST",
            url: "http://localhost/crapi_admin/api/login/login", // Example 
            data: { "email":mail, "password": pw },
            success: function(result_data) {
                console.log(result_data);
                if (result_data.result == 'OK') {

                    if (typeof(Storage) !== "undefined") {
                        localStorage.setItem("login_token", result_data.token);
                        localStorage.setItem("role", result_data.role);
                        
                        switch(result_data.role) {
                            case 'employee':
                                window.location.href = 'a-main.html';
                            break;
                            case 'owner':
                                window.location.href = 'o-main.html';
                            break;
                            case 'customer':
                                window.location.href = 'c-main.html';
                            break;
                            case 'admin':
                                window.location.href = 'admin.html';
                            break;
                          default:
                            $.growl.error({ message: "Sorry! your account not recognize!" });
                        }

                    } else {
                        $.growl.error({ message: "Sorry! browser not supported!" });

                    }

                    $.growl.notice({ message: result_data.description });
                } else {
                    $.growl.error({ message: result_data.description });
                    return false;

                }
            },
            error: function(e) {
                $.growl.error({ message: "Connection refused!"});
                return false;
            }
        });
    });

    function validateEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }
</script>
</body>
</html>