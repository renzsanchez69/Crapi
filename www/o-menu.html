<!DOCTYPE html>
<html>
<head>
	<title>MENU</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="js/o-main.js"></script>
	<link rel="stylesheet" type="text/css" href="css/o-main.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" type="text/css" href="css/o-menu.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="lib/jquery.min.js"></script>
	<script src="lib/bootstrap.min.js"></script>
<body>

<!-- Top Navigation Menu -->
<div class="topnav" id="myTopnav">
	<a href="o-menu.html" class="active">Food Menu</a>
	<a href="o-main.html">Employee</a>
	<a href="o-sub.html">Subscription</a>
	<a href="o-hist.html">Order History</a>
	<a href="index.html">Logout</a>
	<a href="javascript:void(0);" class="icon" onclick="myFunction()">
		<i class="fa fa-bars"></i>
  	</a>
</div>

<div class="main">
	<br>
	<div class="title">
		<h1>MENU OF THE DAY</h1>
	</div>
	<br>

	<div class="left">
		<form action="">
			<input class="search" type="text" placeholder="Search.." name="search">
			<button type="submit" id="btnSearch"><i class="fa fa-search"></i></button>
		</form>
	</div>

	<div class="right">
		<!-- php --><button class="add" id="myAdd" data-toggle="modal" data-target="#ADDfood">ADD FOOD</button><!-- php -->
	</div>
	<div class="t-title">
		<table class="table table-condensed">
			<thead>
				<tr>
					<th>Food name</th>
					<th>Price</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody id="prodListResult"></tbody>

			<!-- data -->
			<tr id="masterProdRow" class="hidden">
				<th class="prodName">--</th>
				<th class="prodPrice">--</th>
				<th>
					<button class="prodEditBtn" name="edit_btn" data-toggle="modal" data-target="#EDITprod"><i class="glyphicon glyphicon-edit"></i></button>
					<button class="prodDeleteBtn" name="delete_btn" data-toggle="modal" data-target="#DELprod"><i class="glyphicon glyphicon-trash"></i></button>
				</th>
			</tr>
		</table>
	</div>
</div>


<!-- Add Modal -->
<div class="modal fade" id="ADDfood" role="dialog">
<div class="modal-content">
  <div class="modal-header">
	<span class="close" data-dismiss="modal">&times;</span>
	<h2>ADD FOOD</h2>
  </div>
  <div class="modal-body">
   <div class="regbox">
	 <form class="reg" action="">
	   <label for="image">Select image of food</label>
	   <input type="file" name="image" id="image">
	   <input type="text" placeholder="Food name" name="fname" required>
	   <input type="text" placeholder="Food description" name="fdesc" required>
	   <input type="text" placeholder="Food price" name="fprice" required>
	   <button class="submit" name="submit_btn">SUBMIT</button>
	 </form>
   </div>
  </div>
</div>
</div>

<div class="modal fade" id="EDITfood" role="dialog">
  <div class="modal-dialog modal-lg">
	<div class="modal-content">
	  <div class="modal-header">
		<span class="close" data-dismiss="modal">&times;</span>
		<h2>EDIT FOOD</h2>
	  </div>
	  <div class="modal-body">
		<div class="regbox">
		  <form class="reg" action="">
		   <input type="text" placeholder="Food name" name="fname" value="Japanese Siomai" required>
		   <input type="text" placeholder="Food description" name="fdesc" value="Not your ordinary siomai" required>
		   <input type="text" placeholder="Food price" name="fprice" value="P 8.00" required>
		   <button class="save" name="edit_btn">SAVE</button>
		  </form>
		</div>
	  </div>
	</div>
  </div>
</div>

<div class="modal fade" id="DELfood" role="dialog">
  <div class="modal-dialog modal-lg">
   <div class="modal-content">
	<div class="modal-header">
	 <span class="close" data-dismiss="modal">&times;</span>
	 <h2>DELETE FOOD</h2>
	</div>
   <div class="modal-body">
	<div class="regbox">
	 <p>Are you sure you want to delete this food?</p>
	 <button class="delete" name="del_btn">DELETE</button>
	 <button data-dismiss="modal">NO</button>
	</div>
   </div>
   </div>
  </div>
</div>

</div>

</body>
<script src="js/jquery.growl.js" type="text/javascript"></script>
<script src="common/constants.js"></script>
<script src="common/app.js"></script>
<script>
	var restoid = null;
	var prodid = null;
	$(document).ready(function(){
		loadRestaurantInfo();

		$('#btnSearch').click(function(e){
			e.preventDefault();
			loadProducts();
		});

		$(document).on('click', '.prodDeleteBtn', function(e){
			e.preventDefault();
			prodid = $(this).data('prodid');
		});

		// $(document).on('click', '[name="del_btn"]', function(e){
		// 	e.preventDefault();
		// 	deleteProduct(prodid);
		// });

		// $(document).on('click', '[name="create_btn"]', function(e){
		// 	e.preventDefault();
		// 	// prodid = $(this).data('prodid');
		// 	createEmployee()
		// });

	});

	function loadProducts(){
		CrapiApp.showCommonLoader();
		var search = $('[name="search"]').val();
		CrapiApp.searchProducts({
			name: search,
			resto_id: restoid
		})
		.then(function(res){
			$('#prodListResult').html('');

			if (res.result === 'OK') {
				for (var key in res.data) {
					// skip loop if the property is from prototype
					if (!res.data.hasOwnProperty(key)) continue;
					var obj = res.data[key];
					var prodRow = $('#masterProdRow').clone();
					prodRow.removeClass('hidden');
					prodRow.find('.prodName').html(obj.name);
					prodRow.find('.prodPrice').html(obj.price);
					prodRow.find('.prodEditBtn').attr('data-prodid', obj.id);
					prodRow.find('.prodDeleteBtn').attr('data-prodid', obj.id);

					$('#prodListResult').append(prodRow);
				}
			}
		})
		.always(function(){
			CrapiApp.removeCommonLoader();
		});
	}

	function loadRestaurantInfo(){
		CrapiApp.searchResto({
			owner_id: CrapiApp.config.login_data.user_id
		})
		.then(function(res){
			$('.loader').remove();

			if (res.result === 'OK') {
				if (typeof res.data[0] !== 'undefined') {
					var obj = res.data[0];
					restoid = obj.id
					loadProducts();
				}
			}
		})
		.catch(function(err){
			console.warn(err);
		});
	}


</script>
</html>